---
interface AccordionItem {
  question: string;
  answer: string;
}

interface Props {
  items: AccordionItem[];
  language?: 'en' | 'es';
}

const { items, language = 'en' } = Astro.props;
---

<div class="accordion-container space-y-4 md:space-y-6">
  {items.map((item, index) => (
    <div class="accordion-item bg-secondary rounded-lg overflow-hidden">
      <button
        class="accordion-button w-full text-left bg-secondary p-4 md:p-6 rounded-lg hover:bg-secondary/80 transition-colors"
        data-accordion-index={index}
        aria-expanded="false"
        aria-controls={`accordion-content-${index}`}
      >
        <div class="flex items-center justify-between">
          <h3 class="text-lg md:text-xl font-heading font-semibold text-primary pr-4">
            {item.question}
          </h3>
          <svg
            class="accordion-icon w-6 h-6 text-accent flex-shrink-0 transition-transform duration-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </div>
      </button>
      <div
        id={`accordion-content-${index}`}
        class="accordion-content hidden px-4 md:px-6 pb-4 md:pb-6"
        style="max-height: 0;"
      >
        <p class="text-sm md:text-base text-text leading-relaxed">
          {item.answer}
        </p>
      </div>
    </div>
  ))}
</div>

<script>
  (function() {
    try {
      function initAccordion() {
        try {
          const buttons = document.querySelectorAll('.accordion-button');
          
          buttons.forEach(button => {
            try {
              button.addEventListener('click', () => {
                try {
                  const index = button.getAttribute('data-accordion-index');
                  const content = document.getElementById(`accordion-content-${index}`);
                  const icon = button.querySelector('.accordion-icon');
                  const isExpanded = button.getAttribute('aria-expanded') === 'true';
                  
                  if (isExpanded) {
                    // Close this item with animation
                    if (content) {
                      const currentHeight = content.scrollHeight;
                      content.style.maxHeight = `${currentHeight}px`;
                      // Force reflow
                      void content.offsetHeight;
                      content.classList.add('accordion-closing');
                      content.style.maxHeight = '0';
                      setTimeout(() => {
                        content.classList.add('hidden');
                        content.classList.remove('accordion-closing');
                        content.style.maxHeight = '';
                      }, 300);
                    }
                    button.setAttribute('aria-expanded', 'false');
                    icon?.classList.remove('rotate-180');
                  } else {
                    // Close all other items with animation
                    buttons.forEach(otherButton => {
                      try {
                        const otherIndex = otherButton.getAttribute('data-accordion-index');
                        if (otherIndex !== index) {
                          const otherContent = document.getElementById(`accordion-content-${otherIndex}`);
                          const otherIcon = otherButton.querySelector('.accordion-icon');
                          if (otherContent && !otherContent.classList.contains('hidden')) {
                            const currentHeight = otherContent.scrollHeight;
                            otherContent.style.maxHeight = `${currentHeight}px`;
                            void otherContent.offsetHeight;
                            otherContent.classList.add('accordion-closing');
                            otherContent.style.maxHeight = '0';
                            setTimeout(() => {
                              otherContent.classList.add('hidden');
                              otherContent.classList.remove('accordion-closing');
                              otherContent.style.maxHeight = '';
                            }, 300);
                          }
                          otherButton.setAttribute('aria-expanded', 'false');
                          otherIcon?.classList.remove('rotate-180');
                        }
                      } catch (err) {
                        // Silently fail for individual button handling
                      }
                    });
                    
                    // Open this item with animation
                    if (content) {
                      content.classList.remove('hidden');
                      const targetHeight = content.scrollHeight;
                      content.style.maxHeight = '0';
                      // Force reflow
                      void content.offsetHeight;
                      content.classList.add('accordion-opening');
                      content.style.maxHeight = `${targetHeight}px`;
                      setTimeout(() => {
                        content.classList.remove('accordion-opening');
                        content.style.maxHeight = '';
                      }, 300);
                    }
                    button.setAttribute('aria-expanded', 'true');
                    icon?.classList.add('rotate-180');
                  }
                } catch (err) {
                  // Silently fail for accordion toggle - non-critical feature
                }
              });
            } catch (err) {
              // Silently fail for individual button setup
            }
          });
        } catch (err) {
          // Silently fail - accordion is a non-critical enhancement
        }
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initAccordion);
      } else {
        initAccordion();
      }
    } catch (error) {
      // Silently fail - accordion is a non-critical enhancement
    }
  })();
</script>

<style>
  .accordion-icon {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .accordion-content {
    overflow: hidden;
    transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .accordion-content.hidden {
    max-height: 0 !important;
    opacity: 0;
  }
  
  .accordion-content.accordion-opening {
    opacity: 1;
  }
  
  .accordion-content.accordion-closing {
    opacity: 0;
  }
  
  .accordion-button {
    transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
  }
  
  .accordion-button:active {
    transform: scale(0.98);
  }
</style>
